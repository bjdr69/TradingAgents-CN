# 实施计划: 手机UI增强

## 任务1: 增强手机UI分析表单
- **描述**: 修改 `mobile_app.py` 中的 `render_mobile_analysis_form` 函数，集成Web端 `analysis_form.py` 的完整功能。
- **具体步骤**:
    1.  添加市场选择下拉框（A股、港股、美股）。
    2.  添加股票代码输入框，支持不同市场的代码格式提示。
    3.  添加分析日期选择器（可选，默认当日）。
    4.  添加分析师团队多选框（市场、新闻、社交媒体、基本面）。
    5.  添加研究深度选择滑块（快速，基础，标准，深度，全面）。
    6.  更新表单提交逻辑，将这些新参数封装成 `analysis_params` 传递给分析任务创建函数。
- **关联需求**: #1

## 任务2: 集成AI模型配置和记忆功能
- **描述**: 在 `mobile_app.py` 中新增或重构部分UI，以配置AI模型和记忆功能，参考 `web/components/sidebar.py`。
- **具体步骤**:
    1.  在分析表单中或通过新的标签页/展开面板，添加LLM提供商选择下拉框。
    2.  根据提供商动态显示模型选择（对于OpenRouter，需要处理分类和自定义输入）。
    3.  添加“启用记忆功能”复选框。
    4.  实现配置的加载和保存逻辑，复用 `web/utils/persistence.py` 中的 `load_model_selection` 和 `save_model_selection`。
    5.  将这些配置信息也纳入 `analysis_params`，以便在启动分析任务时使用。
- **关联需求**: #1

## 任务3: 完善手机端详细分析报告展示
- **描述**: 修改 `mobile_app.py` 中的 `render_detailed_result` 函数，以展示完整的分析报告内容，参考 `web/components/results_display.py`。
- **具体步骤**:
    1.  展示投资决策摘要（操作、置信度、风险评分、目标价）。
    2.  使用标签页或可展开区域展示详细的分析模块：市场技术分析、基本面分析、市场情绪分析、新闻事件分析、风险评估、投资建议。
    3.  确保报告内容在移动设备上清晰可读。
- **关联需求**: #1

## 任务4: 集成PDF报告导出功能
- **描述**: 在 `mobile_app.py` 的分析报告展示页面集成PDF导出功能，参考 `web/utils/report_exporter.py`。
- **具体步骤**:
    1.  在报告展示页面底部添加“导出报告”区域。
    2.  集成或调用 `render_export_buttons` 函数，或实现生成PDF并提供下载链接的逻辑。
    3.  确保在移动浏览器上下载功能正常工作。
- **关联需求**: #1

## 任务5: 强化后台任务管理与持久化（核心机制）
- **描述**: 确保分析任务在后台稳定、可靠地运行，并能在应用重启后恢复任务状态。
- **具体步骤**:
    1.  **分析任务创建**：在 `task_manager.create_task` 中，确保 `analysis_params` 包含所有必要的配置（股票代码、市场、日期、分析师、深度、模型配置等）。
    2.  **后台执行**：`run_analysis_in_background` 函数需接收完整的 `analysis_params`，并将其传递给 `run_stock_analysis` 函数。确保所有参数都能正确传递。
    3.  **进度回调**：利用现有的 `progress_callback` 机制，通过 `task_manager.update_task_status` 实时更新任务进度。
    4.  **结果存储**：分析完成后，将完整的 `result` 对象存储在任务的 `result` 字段中。
    5.  **错误处理**：在 `run_analysis_in_background` 中捕获所有异常，并通过 `task_manager.update_task_status` 将任务状态更新为 'failed'，同时存储错误信息。
    6.  **任务持久化（可选增强）**：考虑将会话状态（如当前任务列表）持久化到 Redis 或文件系统，以便在应用服务重启后能够恢复正在进行的任务。这可以复用 `web/utils/smart_session_manager.py` 中的部分逻辑。
- **关联需求**: #1

## 任务6: UI/UX 优化与测试
- **描述**: 对增强后的手机UI进行优化和全面测试。
- **具体步骤**:
    1.  优化移动端UI布局和交互，确保在不同尺寸设备上表现良好。
    2.  进行端到端功能测试，验证所有新集成的功能。
    3.  进行配置持久化测试，确保模型和分析配置在应用重启后能正确恢复。
    4.  测试后台任务的稳定性和恢复能力。
- **关联需求**: #1